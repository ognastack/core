_format_version: '3.0'
_transform: true

consumers:
  - username: ogna-user
    jwt_secrets:
      - key: authenticated
        secret: superlongjwtsecret
        algorithm: HS256

services:
  - name: gotrue-service
    url: http://gotrue:9999
    routes:
      - name: gotrue-route
        paths:
          - /auth

  - name: dashboard
    url: http://dashboard:3000
    routes:
      - name: dashboard-route
        paths:
          - /

  - name: api-service
    url: http://api:8000
    routes:
      - name: api-route
        paths:
          - /api
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
          key_claim_name: aud
      - name: rate-limiting
        config:
          second: 30
          minute: 100
          policy: local

  - name: storage-service
    url: http://storage:8000
    routes:
      - name: storage-route
        paths:
          - /storage
    plugins:
      - name: jwt
        config:
          claims_to_verify:
            - exp
          key_claim_name: aud
      - name: rate-limiting
        config:
          second: 30
          minute: 100
          policy: local


plugins:
  - name: cors
    config:
      origins:
        - http://localhost:3000
        - http://127.0.0.1:3000
        - http://127.0.0.1:8000
        - http://localhost:8000
        - http://localhost:5173
        - http://127.0.0.1:5173
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      headers:
        - Authorization
        - Content-Type
      credentials: true
  - name: jwt-blacklist
    config:
      redis_host: redis
      redis_port: 6379
