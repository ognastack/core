_format_version: "3.0"
_transform: true

############################
# CONSUMERS
############################

consumers:
  - username: ogna-platform
    jwt_secrets:
      - key: authenticated
        secret: vPDsBi2TafJuP4iqp40qx60AR34Qf6hQgC8GWBB7GoOKGqL9V6
        algorithm: HS256

############################
# SERVICES
############################

services:
  ##################################
  # GoTrue (AUTH)
  ##################################
  - name: gotrue-service
    url: http://gotrue:9999
    routes:
      - name: gotrue-route
        paths:
          - /auth

  ##################################
  # Dashboard (PUBLIC)
  ##################################
  - name: dashboard
    url: http://dashboard:3000
    routes:
      - name: dashboard-route
        paths:
          - /

  ##################################
  # API SERVICE
  ##################################
  - name: api-service
    url: http://api:8000
    routes:
      - name: api-route
        paths:
          - /api
    plugins:
      - name: jwt
        config:
          key_claim_name: aud
          claims_to_verify:
            - exp
      - name: rate-limiting
        config:
          second: 500
          minute: 1000
          policy: local

  ##################################
  # STORAGE SERVICE
  ##################################
  - name: storage-service
    url: http://storage:8000
    routes:
      - name: storage-route
        paths:
          - /storage
    plugins:
      - name: jwt
        config:
          key_claim_name: aud
          claims_to_verify:
            - exp
      - name: rate-limiting
        config:
          second: 500
          minute: 1000
          policy: local

  ##################################
  # HASURA (INTERNAL GRAPHQL)
  ##################################
  - name: hasura
    url: http://hasura:8080/v1/graphql
    routes:
      - name: graphql
        paths:
          - /graphql

############################
# GLOBAL PLUGINS
############################

plugins:
  ##################################
  # CORS
  ##################################
  - name: cors
    config:
      origins:
        - http://localhost:3000
        - http://127.0.0.1:3000
        - http://localhost:5173
        - http://127.0.0.1:5173
        - http://localhost:8000
        - http://127.0.0.1:8000
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      headers:
        - Authorization
        - Content-Type
      credentials: true

  ##################################
  # JWT BLACKLIST (OPTIONAL)
  ##################################
  - name: jwt-blacklist
    config:
      redis_host: redis
      redis_port: 6379
