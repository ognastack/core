_format_version: "3.0"
_transform: true

consumers:
  - username: authentik-user
    jwt_secrets:
      - key: authenticated
        algorithm: RS256
        rsa_public_key: |
          -----BEGIN PUBLIC KEY-----
          MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqBIM63KNkNeG6qCVYHvr
          5vl2OHEm3lbJ5X01vSZshJmqVL0k05PKdlRokbAitvAEMnP+rKWlN85i8nlsb8aP
          nAXg7qsB1FGgg+9V5Qje24WeSEwHHVtiBdfARz9neF7378bcQMnyRt1LwHp0Smf8
          9Hb/03GLV+Hp9SwwRYcfEoSMO7OAx5/hMolvEGbAecHmeQXU6Y7y3utX5JxJ4o2m
          zB7PLz+vKnOzdQhyD/ZQ2kFJCIY6dU3jn3edwfQOpm+fLkhKYGwjLOBBmpzUihp9
          5vqbzn1P6j28gWrc9NrQV7zGhQJJYGc32AhZ0bw18yDMoZF1c0v1E3hAWfQUICri
          mQIDAQAB
          -----END PUBLIC KEY-----

services:

  - name: api-service
    url: http://api:8000
    routes:
      - name: api-route
        paths:
          - /api
    plugins:
      - name: jwt
        config:
          key_claim_name: aud
          claims_to_verify:
            - exp
      - name: rate-limiting
        config:
          second: 30
          minute: 100
          policy: local

  - name: storage-service
    url: http://storage:8000
    routes:
      - name: storage-route
        paths:
          - /storage
    plugins:
      - name: jwt
        config:
          key_claim_name: aud
          claims_to_verify:
            - exp
      - name: rate-limiting
        config:
          second: 30
          minute: 100
          policy: local

plugins:
  - name: cors
    config:
      origins:
        - http://localhost:3000
        - http://127.0.0.1:3000
        - http://localhost:5173
        - http://127.0.0.1:5173
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      headers:
        - Authorization
        - Content-Type
      credentials: true

  - name: jwt-blacklist
    config:
      redis_host: redis
      redis_port: 6379
